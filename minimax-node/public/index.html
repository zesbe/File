<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniMax Web UI</title>

  <style>
    body { font-family: system-ui, Arial; background: #f3f4f6; margin: 0; }
    .app { max-width: 900px; margin: 24px auto; background: #fff; border-radius: 8px;
           box-shadow: 0 6px 18px rgba(0,0,0,0.08); overflow: hidden; }
    header { padding: 16px; border-bottom: 1px solid #eee; }
    main { padding: 16px; height: 65vh; overflow-y: auto; }
    footer { padding: 12px; border-top: 1px solid #eee; display: flex; gap: 8px; }

    .msg { padding: 10px; border-radius: 8px; margin-bottom: 10px; max-width: 75%; }
    .user { background: #2563eb; color: #fff; margin-left: auto; }
    .assistant { background: #f3f4f6; color: #111; margin-right: auto; }

    .img-preview { max-height: 180px; border-radius: 6px; display: block; margin-bottom: 8px; }
    button { padding: 8px 12px; background: #22c55e; color: #fff; border: none; border-radius: 6px; }
    input[type="text"] { flex: 1; padding: 8px; border-radius: 6px; border: 1px solid #ddd; }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <h2>MiniMax Web Chat</h2>
      <div style="font-size:13px;color:#666">Chat + Upload Gambar</div>
    </header>

    <main id="chat"></main>

    <footer>
      <input id="file" type="file" accept="image/*" />
      <input id="text" type="text" placeholder="Ketik pesan..." />
      <button id="send">Send</button>
    </footer>
  </div>

<script>
  const chatEl = document.getElementById("chat");
  const textEl = document.getElementById("text");
  const fileEl = document.getElementById("file");
  const sendBtn = document.getElementById("send");

  let imageFile = null;

  fileEl.addEventListener("change", e => {
    imageFile = e.target.files[0] || null;
  });

  function appendMsg(role, text, imgUrl) {
    const div = document.createElement("div");
    div.className = "msg " + (role === "user" ? "user" : "assistant");

    if (imgUrl) {
      const img = document.createElement("img");
      img.src = imgUrl;
      img.className = "img-preview";
      div.appendChild(img);
    }

    const p = document.createElement("div");
    p.textContent = text;
    div.appendChild(p);

    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  async function send() {
    const message = textEl.value.trim();
    if (!message && !imageFile) return;

    appendMsg("user", message, imageFile ? URL.createObjectURL(imageFile) : null);

    let imageUrl = null;

    if (imageFile) {
      const fd = new FormData();
      fd.append("image", imageFile);

      const r = await fetch("/api/upload", { method: "POST", body: fd });
      const j = await r.json();
      imageUrl = j.url;

      imageFile = null;
      fileEl.value = null;
    }

    textEl.value = "";

    const r = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message, imageUrl })
    });

    const j = await r.json();

    appendMsg("assistant", j.reply || "[no reply]", imageUrl);
  }

  sendBtn.addEventListener("click", send);
  textEl.addEventListener("keydown", e => {
    if (e.key === "Enter") send();
  });
</script>

</body>
</html>
