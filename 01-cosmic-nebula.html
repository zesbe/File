<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cosmic Nebula - Algorithmic Art</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Lora:wght@400&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Lora', Georgia, serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      min-height: 100vh;
      color: #faf9f5;
    }
    .container {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 280px;
      background: rgba(20, 20, 19, 0.95);
      padding: 24px;
      border-right: 1px solid rgba(176, 174, 165, 0.2);
      overflow-y: auto;
    }
    .main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    h1 {
      font-family: 'Poppins', Arial, sans-serif;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #faf9f5;
    }
    .subtitle {
      font-size: 12px;
      color: #b0aea5;
      margin-bottom: 24px;
    }
    .section {
      margin-bottom: 24px;
    }
    .section-title {
      font-family: 'Poppins', Arial, sans-serif;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #b0aea5;
      margin-bottom: 12px;
    }
    .control-group {
      margin-bottom: 16px;
    }
    .control-group label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      color: #e8e6dc;
    }
    .control-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    input[type="range"] {
      flex: 1;
      height: 4px;
      -webkit-appearance: none;
      background: #b0aea5;
      border-radius: 2px;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: #d97757;
      border-radius: 50%;
      cursor: pointer;
    }
    .value-display {
      min-width: 40px;
      text-align: right;
      font-size: 12px;
      color: #b0aea5;
      font-family: monospace;
    }
    .seed-display {
      background: rgba(232, 230, 220, 0.1);
      padding: 10px 14px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 14px;
      text-align: center;
      margin-bottom: 12px;
      color: #6a9bcc;
    }
    .seed-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin-bottom: 12px;
    }
    .seed-jump {
      display: flex;
      gap: 8px;
    }
    .seed-jump input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid rgba(176, 174, 165, 0.3);
      border-radius: 4px;
      background: rgba(232, 230, 220, 0.05);
      color: #faf9f5;
      font-size: 13px;
    }
    button {
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      font-family: 'Poppins', Arial, sans-serif;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-secondary {
      background: rgba(232, 230, 220, 0.1);
      color: #e8e6dc;
    }
    .btn-secondary:hover {
      background: rgba(232, 230, 220, 0.2);
    }
    .btn-primary {
      background: #d97757;
      color: #faf9f5;
    }
    .btn-primary:hover {
      background: #c46647;
    }
    .btn-accent {
      background: #6a9bcc;
      color: #141413;
    }
    .btn-accent:hover {
      background: #5a8bbc;
    }
    .actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .actions button {
      width: 100%;
    }
    #canvas-container canvas {
      border-radius: 8px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    input[type="color"] {
      width: 40px;
      height: 28px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <h1>Cosmic Nebula</h1>
      <p class="subtitle">Stellar Genesis Movement</p>

      <div class="section">
        <div class="section-title">Seed</div>
        <div class="seed-display" id="seed-display">12345</div>
        <div class="seed-buttons">
          <button class="btn-secondary" onclick="prevSeed()">← Prev</button>
          <button class="btn-accent" onclick="randomSeed()">Random</button>
          <button class="btn-secondary" onclick="nextSeed()">Next →</button>
        </div>
        <div class="seed-jump">
          <input type="number" id="seed-input" placeholder="Jump to seed...">
          <button class="btn-secondary" onclick="jumpToSeed()">Go</button>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Parameters</div>
        
        <div class="control-group">
          <label>Particle Count</label>
          <div class="control-row">
            <input type="range" id="particleCount" min="100" max="2000" value="800" oninput="updateParam('particleCount', this.value)">
            <span class="value-display" id="particleCount-value">800</span>
          </div>
        </div>

        <div class="control-group">
          <label>Flow Scale</label>
          <div class="control-row">
            <input type="range" id="flowScale" min="50" max="500" value="200" oninput="updateParam('flowScale', this.value)">
            <span class="value-display" id="flowScale-value">200</span>
          </div>
        </div>

        <div class="control-group">
          <label>Trail Length</label>
          <div class="control-row">
            <input type="range" id="trailLength" min="5" max="100" value="40" oninput="updateParam('trailLength', this.value)">
            <span class="value-display" id="trailLength-value">40</span>
          </div>
        </div>

        <div class="control-group">
          <label>Particle Speed</label>
          <div class="control-row">
            <input type="range" id="speed" min="0.5" max="5" step="0.1" value="1.5" oninput="updateParam('speed', this.value)">
            <span class="value-display" id="speed-value">1.5</span>
          </div>
        </div>

        <div class="control-group">
          <label>Turbulence</label>
          <div class="control-row">
            <input type="range" id="turbulence" min="1" max="8" step="0.5" value="4" oninput="updateParam('turbulence', this.value)">
            <span class="value-display" id="turbulence-value">4</span>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Colors</div>
        
        <div class="control-group">
          <label>Hot Color</label>
          <div class="control-row">
            <input type="color" id="hotColor" value="#6ab8ff" onchange="updateColor('hotColor', this.value)">
            <span class="value-display" id="hotColor-value">#6ab8ff</span>
          </div>
        </div>

        <div class="control-group">
          <label>Cool Color</label>
          <div class="control-row">
            <input type="color" id="coolColor" value="#ff6b4a" onchange="updateColor('coolColor', this.value)">
            <span class="value-display" id="coolColor-value">#ff6b4a</span>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Actions</div>
        <div class="actions">
          <button class="btn-primary" onclick="regenerate()">Regenerate</button>
          <button class="btn-secondary" onclick="resetDefaults()">Reset Defaults</button>
          <button class="btn-accent" onclick="downloadPNG()">Download PNG</button>
        </div>
      </div>
    </div>

    <div class="main">
      <div id="canvas-container"></div>
    </div>
  </div>

  <script>
    let params = {
      seed: 12345,
      particleCount: 800,
      flowScale: 200,
      trailLength: 40,
      speed: 1.5,
      turbulence: 4,
      hotColor: '#6ab8ff',
      coolColor: '#ff6b4a'
    };

    const defaults = { ...params };
    let particles = [];
    let flowField;
    let cols, rows;
    let zoff = 0;

    function setup() {
      let canvas = createCanvas(700, 700);
      canvas.parent('canvas-container');
      colorMode(HSB, 360, 100, 100, 100);
      initializeSystem();
    }

    function initializeSystem() {
      randomSeed(params.seed);
      noiseSeed(params.seed);
      
      background(0);
      particles = [];
      
      let scl = 10;
      cols = floor(width / scl);
      rows = floor(height / scl);
      flowField = new Array(cols * rows);
      
      for (let i = 0; i < params.particleCount; i++) {
        particles.push(new Particle());
      }
      
      zoff = 0;
    }

    function draw() {
      // Fade effect for trails
      noStroke();
      fill(0, 0, 0, 100 / params.trailLength);
      rect(0, 0, width, height);
      
      // Update flow field
      let yoff = 0;
      for (let y = 0; y < rows; y++) {
        let xoff = 0;
        for (let x = 0; x < cols; x++) {
          let index = x + y * cols;
          let angle = noise(xoff, yoff, zoff) * TWO_PI * params.turbulence;
          flowField[index] = p5.Vector.fromAngle(angle);
          flowField[index].setMag(1);
          xoff += 0.1;
        }
        yoff += 0.1;
      }
      zoff += 0.002;
      
      // Update and draw particles
      for (let p of particles) {
        p.follow(flowField);
        p.update();
        p.edges();
        p.show();
      }
    }

    class Particle {
      constructor() {
        this.pos = createVector(random(width), random(height));
        this.vel = createVector(0, 0);
        this.acc = createVector(0, 0);
        this.maxSpeed = params.speed;
        this.prevPos = this.pos.copy();
        this.hueOffset = random(60);
      }
      
      follow(vectors) {
        let x = floor(this.pos.x / 10);
        let y = floor(this.pos.y / 10);
        let index = x + y * cols;
        if (index >= 0 && index < vectors.length) {
          let force = vectors[index];
          this.applyForce(force);
        }
      }
      
      applyForce(force) {
        this.acc.add(force);
      }
      
      update() {
        this.vel.add(this.acc);
        this.vel.limit(this.maxSpeed);
        this.pos.add(this.vel);
        this.acc.mult(0);
      }
      
      edges() {
        if (this.pos.x > width) { this.pos.x = 0; this.updatePrev(); }
        if (this.pos.x < 0) { this.pos.x = width; this.updatePrev(); }
        if (this.pos.y > height) { this.pos.y = 0; this.updatePrev(); }
        if (this.pos.y < 0) { this.pos.y = height; this.updatePrev(); }
      }
      
      updatePrev() {
        this.prevPos.x = this.pos.x;
        this.prevPos.y = this.pos.y;
      }
      
      show() {
        let speed = this.vel.mag();
        let hotC = hexToHSB(params.hotColor);
        let coolC = hexToHSB(params.coolColor);
        
        let t = map(speed, 0, this.maxSpeed, 0, 1);
        let h = lerp(coolC.h, hotC.h, t);
        let s = lerp(coolC.s, hotC.s, t);
        let b = lerp(coolC.b, hotC.b, t);
        
        stroke(h + this.hueOffset, s, b, 60);
        strokeWeight(1.5);
        line(this.pos.x, this.pos.y, this.prevPos.x, this.prevPos.y);
        this.updatePrev();
      }
    }

    function hexToHSB(hex) {
      let r = parseInt(hex.slice(1, 3), 16) / 255;
      let g = parseInt(hex.slice(3, 5), 16) / 255;
      let b = parseInt(hex.slice(5, 7), 16) / 255;
      
      let max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, v = max;
      let d = max - min;
      s = max == 0 ? 0 : d / max;
      
      if (max == min) {
        h = 0;
      } else {
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      
      return { h: h * 360, s: s * 100, b: v * 100 };
    }

    function updateParam(name, value) {
      params[name] = parseFloat(value);
      document.getElementById(name + '-value').textContent = value;
      
      if (name === 'particleCount') {
        initializeSystem();
      }
    }

    function updateColor(name, value) {
      params[name] = value;
      document.getElementById(name + '-value').textContent = value;
    }

    function prevSeed() {
      params.seed = Math.max(1, params.seed - 1);
      document.getElementById('seed-display').textContent = params.seed;
      initializeSystem();
    }

    function nextSeed() {
      params.seed++;
      document.getElementById('seed-display').textContent = params.seed;
      initializeSystem();
    }

    function randomSeed() {
      params.seed = Math.floor(Math.random() * 100000);
      document.getElementById('seed-display').textContent = params.seed;
      initializeSystem();
    }

    function jumpToSeed() {
      let val = parseInt(document.getElementById('seed-input').value);
      if (!isNaN(val) && val > 0) {
        params.seed = val;
        document.getElementById('seed-display').textContent = params.seed;
        initializeSystem();
      }
    }

    function regenerate() {
      initializeSystem();
    }

    function resetDefaults() {
      params = { ...defaults };
      document.getElementById('seed-display').textContent = params.seed;
      document.getElementById('particleCount').value = params.particleCount;
      document.getElementById('particleCount-value').textContent = params.particleCount;
      document.getElementById('flowScale').value = params.flowScale;
      document.getElementById('flowScale-value').textContent = params.flowScale;
      document.getElementById('trailLength').value = params.trailLength;
      document.getElementById('trailLength-value').textContent = params.trailLength;
      document.getElementById('speed').value = params.speed;
      document.getElementById('speed-value').textContent = params.speed;
      document.getElementById('turbulence').value = params.turbulence;
      document.getElementById('turbulence-value').textContent = params.turbulence;
      document.getElementById('hotColor').value = params.hotColor;
      document.getElementById('hotColor-value').textContent = params.hotColor;
      document.getElementById('coolColor').value = params.coolColor;
      document.getElementById('coolColor-value').textContent = params.coolColor;
      initializeSystem();
    }

    function downloadPNG() {
      saveCanvas('cosmic-nebula-' + params.seed, 'png');
    }
  </script>
</body>
</html>
